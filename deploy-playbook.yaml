---
- name: Install Router VMs
  ansible.builtin.import_playbook: router/build-router-vm-playbook.yaml
- name: Create a set new SSH key for clusters and routers
  ansible.builtin.import_playbook: networking/add-ssh-key-to-nodes-playbook.yaml
- name: Accept ssh keys for the first time
  ansible.builtin.import_playbook: networking/accept-ssh-keys-playbook.yaml
- name: Networking - Setup static internal IPs
  ansible.builtin.import_playbook: networking/dhcp-server-config-playbook.yaml
- name: Wait for connection
  gather_facts: true
  hosts: all
  tasks:
    - name: Wait 30 seconds for connection
      ansible.builtin.wait_for_connection:
        connect_timeout: 3
        timeout: 30
- name: Pre-setup - get correct interfaces
  ansible.builtin.import_playbook: networking/get-interface-playbook.yaml
- name: Networking - Router BGP
  ansible.builtin.import_playbook: networking/router-bgp-playbook.yaml
- name: Networking - VRRP
  ansible.builtin.import_playbook: networking/router-vrrp-playbook.yaml
- name: Networking - Router Controlplane HA
  ansible.builtin.import_playbook: networking/controlplane-ha-playbook.yaml
- name: Nodes - Enable EPEL repositories
  ansible.builtin.import_playbook: node/add-epel-repos-playbook.yaml
